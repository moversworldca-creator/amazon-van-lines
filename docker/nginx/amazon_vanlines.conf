server {
    listen 80;
    server_name _;

    # The absolute path to your exported 'out' folder
    root /var/www/html/amazon-van/out;
    index index.html;

    # 1. Critical: Ensure Nginx knows how to handle file extensions
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # 2. Main routing for Next.js static pages
    location / {
        try_files $uri $uri/ $uri.html /index.html;
    }

    # 3. Handle ALL Next.js static assets (_next/static/...)
    # We use 'root' here instead of 'alias' to prevent MIME-type confusion
    location /_next/static/ {
        # This tells Nginx to look for files in /var/www/html/amazon-van/out/_next/static/
        root /var/www/html/amazon-van/out;
        
        expires 365d;
        access_log off;
        add_header Cache-Control "public, max-age=31536000, immutable";
        
        # Explicitly force types if the global include fails for some reason
        types {
            text/css css;
            application/javascript js;
            font/woff2 woff2;
            image/webp webp;
        }
    }

    error_page 404 /404.html;
}