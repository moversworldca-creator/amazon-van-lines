server {
    listen 80;
    server_name _;

    root /var/www/html/out;
    index index.html;

    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # 1. Backend API Proxy
    # Any request starting with /api will be sent to your Node service
    location /api/ {
        proxy_pass http://localhost:5000; # The port your backend listens on
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        
        # Optional: Forward the real IP of the user to your Node app
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    # 2. Frontend Routing
    location / {
        try_files $uri $uri/ $uri.html /index.html;
    }

    # 3. Next.js Static Assets
    location /_next/static/ {
        root /var/www/html/out;
        expires 365d;
        access_log off;
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    error_page 404 /404.html;
}






















# # 1. Redirect HTTP to HTTPS
# server {
#     listen 80;
#     server_name amazonvanlines.ca www.amazonvanlines.ca;
#     return 301 https://$host$request_uri;
# }

# # 2. HTTPS Server Block
# server {
#     listen 443 ssl;
#     server_name amazonvanlines.ca www.amazonvanlines.ca;

#     ssl_certificate /etc/letsencrypt/live/amazonvanlines.ca/fullchain.pem;
#     ssl_certificate_key /etc/letsencrypt/live/amazonvanlines.ca/privkey.pem;

#     # Point to the 'out' directory
#     root /var/www/html/amazon-van/out;
#     index index.html;

#     include /etc/nginx/mime.types;
#     default_type application/octet-stream;

#     # Static files - Next.js assets with aggressive caching
#     location /_next/static/ {
#         expires 365d;
#         access_log off;
#         add_header Cache-Control "public, max-age=31536000, immutable";
#         try_files $uri =404;
#     }

#     # Public assets (SVG, favicon, etc)
#     location ~* \.(svg|ico|png|jpg|jpeg|gif|webp|woff|woff2|ttf|eot)$ {
#         expires 365d;
#         access_log off;
#         add_header Cache-Control "public, max-age=31536000";
#     }

#     # Routes handling for static export
#     location / {
#         # 1. Try the exact file first
#         # 2. Try with .html extension (important for Next.js routes)
#         # 3. Try as directory (with index.html)
#         # 4. Fallback to index.html for SPA behavior
#         try_files $uri $uri.html $uri/index.html /index.html;
#     }

#     error_page 404 /404.html;
#     error_page 404 =200 /404.html;
# }